<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›²ç«¯æ—¥æ›†å¾…è¾¦æ¸…å–®</title>
    <style>
        :root { --bg: #f5f0e9; --primary: #c4a484; --accent: #8e735b; --text: #5d4e42; --card: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 800px; text-align: center; }
        
        /* å¯†ç¢¼å±¤ */
        #lock-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .login-card { background: #fff; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        #sync-status { font-size: 0.8rem; color: var(--primary); margin-bottom: 10px; height: 1.2rem; font-weight: bold; }
        
        .control-panel { background: #fff; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .date-row { margin-bottom: 15px; display: flex; justify-content: center; align-items: center; gap: 10px; }
        
        .kanban { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 600px) { .kanban { grid-template-columns: 1fr; } }
        
        .column { background: rgba(255,255,255,0.4); border-radius: 15px; padding: 15px; min-height: 300px; text-align: left; }
        .column-title { font-weight: bold; border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 15px; color: var(--accent); }
        
        .task-card { background: #fff; padding: 12px; border-radius: 10px; margin-bottom: 10px; display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .checkbox { margin-right: 10px; cursor: pointer; transform: scale(1.2); }
        .task-text { flex: 1; font-size: 0.95rem; }
        .done-column .task-text { text-decoration: line-through; color: #ccc; }
        
        input, button, select { padding: 12px; border-radius: 10px; border: 1px solid #ddd; outline: none; }
        .date-input { background: var(--bg); border: none; font-weight: bold; color: var(--accent); cursor: pointer; }
        .add-btn { background: var(--accent); color: #fff; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .add-btn:hover { opacity: 0.8; }
    </style>
</head>
<body>

<div id="lock-screen">
    <div class="login-card">
        <h2>ğŸ”’ é›²ç«¯æ—¥èªŒè§£é–</h2>
        <input type="password" id="pwField" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" style="width:200px; margin-bottom:15px; text-align:center;">
        <br>
        <button class="add-btn" style="width:225px;" onclick="unlock()">è§£é–</button>
    </div>
</div>

<div id="main-content" style="display:none;" class="container">
    <h1>My Schedule</h1>
    <div id="sync-status">â˜ï¸ é›²ç«¯åŒæ­¥å·²å°±ç·’</div>

    <div class="control-panel">
        <div class="date-row">
            <span>ğŸ“… æŸ¥çœ‹æ—¥æœŸï¼š</span>
            <input type="date" id="datePicker" class="date-input" onchange="changeDate()">
        </div>
        <div style="display:flex; gap:10px;">
            <input type="text" id="taskInput" placeholder="å¯«ä¸‹è©²æ—¥æœŸçš„ä»»å‹™..." style="flex:1;">
            <button class="add-btn" onclick="addTask()">ADD</button>
        </div>
    </div>

    <div class="kanban">
        <div class="column">
            <div class="column-title">â³ å¾…è™•ç† PENDING</div>
            <div id="pendingList"></div>
        </div>
        <div class="column done-column">
            <div class="column-title">âœ… å·²å®Œæˆ DONE</div>
            <div id="doneList"></div>
        </div>
    </div>
</div>

<script>
    // ã€é€™è£¡æ›¿æ›ç‚ºä½ çš„ Google Script URLã€‘
    const CLOUD_URL = "https://script.google.com/macros/s/AKfycbz7VN2cnuJBAVAOhmeX1cYbDlM4Q3piTYzLJBf2nH5raaQB7Seggo8IucQu7ESzXipV/exec";
    const MY_PW = "0813"; 
    
    let allData = {}; // çµæ§‹ç‚º { "2024-01-13": [...tasks], "2024-01-14": [...] }
    let currentDate = new Date().toISOString().split('T')[0];

    function unlock() {
        if (document.getElementById('pwField').value === MY_PW) {
            document.getElementById('lock-screen').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('datePicker').value = currentDate;
            loadFromCloud();
        } else { alert("å¯†ç¢¼éŒ¯èª¤"); }
    }

    // å¾é›²ç«¯è¼‰å…¥æ‰€æœ‰æ—¥æœŸçš„è³‡æ–™
    async function loadFromCloud() {
        updateStatus("â˜ï¸ æ­£åœ¨è¼‰å…¥é›²ç«¯è³‡æ–™...");
        try {
            const res = await fetch(CLOUD_URL);
            allData = await res.json();
            render();
            updateStatus("â˜ï¸ åŒæ­¥å®Œæˆ");
        } catch (e) { 
            allData = {};
            updateStatus("ğŸ†• æ­¡è¿ä½¿ç”¨ (å»ºç«‹æ–°ç´€éŒ„)");
        }
    }

    // å„²å­˜åˆ°é›²ç«¯
    async function saveToCloud() {
        updateStatus("â˜ï¸ æ­£åœ¨ä¿å­˜è®Šå‹•...");
        await fetch(CLOUD_URL, {
            method: 'POST',
            body: JSON.stringify(allData)
        });
        updateStatus("âœ… é›²ç«¯å·²å­˜æª”");
    }

    function changeDate() {
        currentDate = document.getElementById('datePicker').value;
        render();
    }

    function addTask() {
        const input = document.getElementById('taskInput');
        if (!input.value.trim()) return;

        // å¦‚æœè©²æ—¥æœŸé‚„æ²’å»ºç«‹éæ¸…å–®ï¼Œåˆå§‹åŒ–å®ƒ
        if (!allData[currentDate]) allData[currentDate] = [];
        
        allData[currentDate].push({
            id: Date.now(),
            text: input.value,
            done: false
        });

        input.value = '';
        render();
        saveToCloud();
    }

    function toggleTask(id) {
        allData[currentDate] = allData[currentDate].map(t => 
            t.id === id ? {...t, done: !t.done} : t
        );
        render();
        saveToCloud();
    }

    function deleteTask(id) {
        if(!confirm("ç¢ºå®šåˆªé™¤æ­¤é …å·¥ä½œï¼Ÿ")) return;
        allData[currentDate] = allData[currentDate].filter(t => t.id !== id);
        render();
        saveToCloud();
    }

    function render() {
        const pList = document.getElementById('pendingList');
        const dList = document.getElementById('doneList');
        pList.innerHTML = ''; dList.innerHTML = '';

        const dayTasks = allData[currentDate] || [];

        dayTasks.forEach(t => {
            const card = document.createElement('div');
            card.className = 'task-card';
            card.innerHTML = `
                <input type="checkbox" class="checkbox" ${t.done ? 'checked' : ''} onclick="toggleTask(${t.id})">
                <div class="task-text">${t.text}</div>
                <span style="color:#ddd; cursor:pointer; margin-left:10px;" onclick="deleteTask(${t.id})">âœ•</span>
            `;
            if (t.done) dList.appendChild(card);
            else pList.appendChild(card);
        });

        if (dayTasks.length === 0) {
            pList.innerHTML = '<div style="color:#bbb; font-size:0.8rem; text-align:center; padding-top:20px;">é€™å¤©é‚„æ²’æœ‰ä»»å‹™å–”ï¼</div>';
        }
    }

    function updateStatus(msg) {
        document.getElementById('sync-status').innerText = msg;
    }
</script>
</body>
</html>